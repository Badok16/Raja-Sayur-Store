<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raja Sayur Store - Toko Sayur dan Bumbu Dapur Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #28a745;
            --secondary-color: #ffc107;
            --danger-color: #dc3545;
            --warning-color: #fd7e14;
            --info-color: #17a2b8;
            --light-bg: #f8f9fc;
            --dark-bg: #343a40;
            --success-color: #28a745;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--light-bg);
            color: #333;
        }

        /* Navbar Styles */
        .navbar {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--primary-color) !important;
        }

        .nav-link {
            color: var(--dark-bg) !important;
            font-weight: 600;
            margin: 0 10px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            color: var(--primary-color) !important;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(40, 167, 69, 0.8), rgba(40, 167, 69, 0.8)), url('https://images.unsplash.com/photo-1512820764613-6a8bb6cb5d3a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 100px 0;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
        }

        /* Product Card */
        .product-card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s;
            height: 100%;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .product-card .card-img-top {
            height: 200px;
            object-fit: cover;
        }

        .product-card .card-body {
            padding: 20px;
        }

        .product-card .card-title {
            font-weight: 700;
            margin-bottom: 10px;
            height: 50px;
            overflow: hidden;
        }

        .product-card .card-text {
            color: #666;
            margin-bottom: 15px;
            height: 40px;
            overflow: hidden;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background-color: #218838;
            transform: translateY(-3px);
        }

        /* Category Section */
        .category-card {
            border-radius: 10px;
            overflow: hidden;
            height: 200px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-card:hover {
            transform: scale(1.03);
        }

        .category-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.5s;
        }

        .category-card:hover img {
            transform: scale(1.1);
        }

        .category-card .category-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
        }

        /* Cart */
        .cart-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .cart-table th, .cart-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .cart-table th {
            background: #f9f9f9;
        }

        .cart-table img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }

        .cart-total {
            text-align: right;
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 20px;
        }

        /* Login Form */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Checkout Form */
        .checkout-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .order-summary {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .order-summary h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .order-summary .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .order-summary .order-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 1.2rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .shipping-note {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        .shipping-note i {
            margin-right: 10px;
            color: var(--warning-color);
        }

        /* Order Tracking */
        .order-tracking {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .order-tracking h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .order-tracking .order-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .order-tracking .order-status {
            margin-top: 20px;
        }

        .order-tracking .status-step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-tracking .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #999;
        }

        .order-tracking .status-icon.active {
            background: var(--primary-color);
            color: white;
        }

        .order-tracking .status-icon.completed {
            background: var(--success-color);
            color: white;
        }

        .order-tracking .status-text {
            flex: 1;
        }

        .order-tracking .status-text h5 {
            margin-bottom: 5px;
        }

        .order-tracking .status-text p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        /* Chat Widget */
        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
            transform: translateY(calc(100% - 50px));
        }

        .chat-widget.opened {
            transform: translateY(0);
        }

        .chat-header {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .chat-message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .chat-message.admin {
            align-items: flex-start;
        }

        .chat-message.user {
            align-items: flex-end;
        }

        .chat-bubble {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 5px;
        }

        .chat-message.admin .chat-bubble {
            background: #f1f1f1;
            color: #333;
            border-top-left-radius: 0;
        }

        .chat-message.user .chat-bubble {
            background: var(--primary-color);
            color: white;
            border-top-right-radius: 0;
        }

        .chat-time {
            font-size: 0.7rem;
            color: #999;
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
        }

        .chat-input input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            outline: none;
        }

        .chat-input button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-left: 10px;
            cursor: pointer;
        }

        .chat-form {
            padding: 15px;
            background: #f9f9f9;
            border-top: 1px solid #eee;
        }

        .chat-form input {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .chat-form button {
            width: 100%;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
        }

        .chat-notification {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            background: white;
            min-height: 100vh;
        }

        .admin-sidebar {
            width: 250px;
            background: var(--dark-bg);
            color: white;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }

        .admin-sidebar .sidebar-header {
            padding: 20px;
            background: rgba(0,0,0,0.2);
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .admin-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .admin-menu li {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .admin-menu a {
            display: block;
            padding: 15px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
        }

        .admin-menu a:hover, .admin-menu a.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .admin-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .admin-content {
            margin-left: 250px;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .stat-card {
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
        }

        .stat-card.primary {
            background: var(--primary-color);
        }

        .stat-card.success {
            background: var(--success-color);
        }

        .stat-card.warning {
            background: var(--warning-color);
        }

        .stat-card.danger {
            background: var(--danger-color);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin: 10px 0;
        }

        /* Admin Chat */
        .admin-chat-container {
            display: flex;
            height: calc(100vh - 150px);
        }

        .admin-chat-sidebar {
            width: 300px;
            border-right: 1px solid #eee;
            overflow-y: auto;
        }

        .admin-chat-sidebar .chat-user {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-chat-sidebar .chat-user:hover {
            background: #f9f9f9;
        }

        .admin-chat-sidebar .chat-user.active {
            background: #e9f7ef;
            border-left: 3px solid var(--primary-color);
        }

        .admin-chat-sidebar .chat-user-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .admin-chat-sidebar .chat-user-preview {
            font-size: 0.8rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .admin-chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .admin-chat-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .admin-chat-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .admin-chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .admin-chat-input {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
        }

        .admin-chat-input input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            outline: none;
        }

        .admin-chat-input button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-left: 10px;
            cursor: pointer;
        }

        /* Order Status Badge */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.shipping {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-badge.completed {
            background: #d4edda;
            color: #155724;
        }

        /* Typing Indicator */
        .typing-indicator .chat-bubble {
            background: #f1f1f1;
            color: #333;
            border-top-left-radius: 0;
            padding: 10px 15px;
            display: inline-block;
        }
        
        .typing-dots {
            display: flex;
            align-items: center;
        }
        
        .typing-dots span {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            background-color: #999;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Connection Indicator */
        #connection-indicator {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            color: white;
        }

        /* Quantity Control */
        .quantity-control {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .quantity-control button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .quantity-control input {
            width: 50px;
            text-align: center;
            border: none;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            height: 30px;
        }

        /* Product Detail */
        .product-detail-img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .product-detail-info {
            padding: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .admin-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .admin-sidebar.opened {
                transform: translateX(0);
            }
            
            .admin-content {
                margin-left: 0;
            }
            
            .chat-widget {
                width: 300px;
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <!-- Public View -->
    <div id="public-view">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
                <a class="navbar-brand" href="#" onclick="showPage('home')">
                    <i class="fas fa-store me-2"></i>Raja Sayur Store
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('home')">Beranda</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('products')">Produk</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('categories')">Kategori</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('cart')">
                                <i class="fas fa-shopping-cart me-1"></i>Keranjang (<span id="cart-count">0</span>)
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('orders')">
                                <i class="fas fa-receipt me-1"></i>Pesanan Saya
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('login')">
                                <i class="fas fa-sign-in-alt me-1"></i>Login
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showAdminLogin()">
                                <i class="fas fa-user-cog me-1"></i>Admin
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>Selamat Datang di Raja Sayur Store</h1>
                <p>Temukan sayuran segar dan bumbu dapur berkualitas dengan harga terbaik. Nikmati kemudahan berbelanja dengan layanan pelanggan 24 jam.</p>
                <a href="#" class="btn btn-primary btn-lg" onclick="showPage('products')">Belanja Sekarang</a>
            </div>
        </section>

        <!-- Featured Categories -->
        <section class="py-5">
            <div class="container">
                <h2 class="text-center mb-4">Kategori Populer</h2>
                <div class="row">
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('sayuran')">
                            <img src="https://images.unsplash.com/photo-1592926584220-7c693e6533d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Sayuran">
                            <div class="category-name">Sayuran Segar</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('bumbu')">
                            <img src="https://images.unsplash.com/photo-1619566636858-bc19a4c9839e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Bumbu Dapur">
                            <div class="category-name">Bumbu Dapur</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('organik')">
                            <img src="https://images.unsplash.com/photo-1542831371-29b5f74f9713?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Produk Organik">
                            <div class="category-name">Produk Organik</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('premium')">
                            <img src="https://images.unsplash.com/photo-1505252585461-0281a4047373?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Premium">
                            <div class="category-name">Premium</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Featured Products -->
        <section id="home-page" class="py-5 bg-light">
            <div class="container">
                <h2 class="text-center mb-4">Produk Unggulan</h2>
                <div class="row" id="featured-products">
                    <!-- Products will be loaded here -->
                </div>
                <div class="text-center mt-4">
                    <a href="#" class="btn btn-primary" onclick="showPage('products')">Lihat Semua Produk</a>
                </div>
            </div>
        </section>

        <!-- Products Page -->
        <section id="products-page" class="py-5 d-none">
            <div class="container">
                <h2 class="mb-4">Semua Produk</h2>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <select class="form-select" id="category-filter" onchange="filterProducts()">
                            <option value="">Semua Kategori</option>
                            <option value="sayuran">Sayuran</option>
                            <option value="bumbu">Bumbu Dapur</option>
                            <option value="organik">Produk Organik</option>
                            <option value="premium">Premium</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="sort-filter" onchange="sortProducts()">
                            <option value="default">Urutkan</option>
                            <option value="price-asc">Harga Terendah</option>
                            <option value="price-desc">Harga Tertinggi</option>
                            <option value="name">Nama A-Z</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Cari produk..." id="search-input" onkeyup="searchProducts()">
                            <button class="btn btn-primary" type="button">Cari</button>
                        </div>
                    </div>
                </div>
                <div class="row" id="products-container">
                    <!-- Products will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Categories Page -->
        <section id="categories-page" class="py-5 d-none">
            <div class="container">
                <h2 class="mb-4">Semua Kategori</h2>
                <div class="row">
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('sayuran')">
                            <img src="https://images.unsplash.com/photo-1592926584220-7c693e6533d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Sayuran">
                            <div class="category-name">Sayuran Segar</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('bumbu')">
                            <img src="https://images.unsplash.com/photo-1619566636858-bc19a4c9839e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Bumbu Dapur">
                            <div class="category-name">Bumbu Dapur</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('organik')">
                            <img src="https://images.unsplash.com/photo-1542831371-29b5f74f9713?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Produk Organik">
                            <div class="category-name">Produk Organik</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="category-card" onclick="showProductsByCategory('premium')">
                            <img src="https://images.unsplash.com/photo-1505252585461-0281a4047373?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Premium">
                            <div class="category-name">Premium</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Detail Page -->
        <section id="product-detail-page" class="py-5 d-none">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <img id="product-detail-image" src="" alt="Product Image" class="product-detail-img">
                    </div>
                    <div class="col-md-6">
                        <div class="product-detail-info">
                            <h1 id="product-detail-name"></h1>
                            <div class="product-price" id="product-detail-price"></div>
                            <p id="product-detail-description"></p>
                            
                            <div class="quantity-control">
                                <button onclick="decreaseQuantity()">-</button>
                                <input type="number" id="product-quantity" value="1" min="1" readonly>
                                <button onclick="increaseQuantity()">+</button>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary btn-lg" onclick="addToCart()">
                                    <i class="fas fa-shopping-cart me-2"></i>Tambah ke Keranjang
                                </button>
                                <button class="btn btn-outline-primary btn-lg" onclick="buyNow()">
                                    <i class="fas fa-bolt me-2"></i>Beli Sekarang
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cart Page -->
        <section id="cart-page" class="py-5 d-none">
            <div class="container">
                <h2 class="mb-4">Keranjang Belanja</h2>
                <div id="cart-container">
                    <!-- Cart items will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Checkout Page -->
        <section id="checkout-page" class="py-5 d-none">
            <div class="container">
                <h2 class="mb-4">Checkout</h2>
                <div class="row">
                    <div class="col-md-8">
                        <div class="checkout-form">
                            <h3>Informasi Pengiriman</h3>
                            <div class="form-group">
                                <label>Nama Lengkap <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="checkout-name" placeholder="Nama lengkap" required>
                            </div>
                            <div class="form-group">
                                <label>Nomor Telepon <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="checkout-phone" placeholder="Nomor telepon" required>
                            </div>
                            <div class="form-group">
                                <label>Alamat Lengkap <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="checkout-address" rows="3" placeholder="Alamat lengkap" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>Kota/Kabupaten <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="checkout-city" placeholder="Kota/Kabupaten" required>
                            </div>
                            
                            <h3 class="mt-4">Metode Pembayaran</h3>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="payment-method" id="payment-cod" value="cod" checked>
                                    <label class="form-check-label" for="payment-cod">
                                        Cash on Delivery (COD)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="payment-method" id="payment-transfer" value="transfer">
                                    <label class="form-check-label" for="payment-transfer">
                                        Transfer Bank
                                    </label>
                                </div>
                            </div>
                            
                            <div class="shipping-note">
                                <i class="fas fa-info-circle"></i>
                                <strong>Catatan:</strong> Harga yang tercantum belum termasuk ongkos kirim. Silahkan hubungi admin melalui fitur live chat untuk menanyakan ongkos kirim ke alamat Anda.
                            </div>
                            
                            <button class="btn btn-primary btn-lg mt-4" onclick="placeOrder()">
                                <i class="fas fa-check me-2"></i>Place Order
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="order-summary">
                            <h3>Ringkasan Pesanan</h3>
                            <div id="order-summary-items">
                                <!-- Order items will be loaded here -->
                            </div>
                            <div class="order-total">
                                <span>Total:</span>
                                <span id="order-total-price">Rp 0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Order Success Page -->
        <section id="order-success-page" class="py-5 d-none">
            <div class="container">
                <div class="text-center">
                    <i class="fas fa-check-circle text-success" style="font-size: 5rem;"></i>
                    <h2 class="mt-3">Pesanan Berhasil!</h2>
                    <p>Terima kasih telah berbelanja di Raja Sayur Store. Pesanan Anda sedang diproses.</p>
                    <p>Nomor Pesanan: <strong id="order-number"></strong></p>
                    <div class="mt-4">
                        <a href="#" class="btn btn-primary" onclick="showPage('home')">Kembali ke Beranda</a>
                        <a href="#" class="btn btn-outline-primary" onclick="showPage('orders')">Lihat Pesanan Saya</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Orders Page -->
        <section id="orders-page" class="py-5 d-none">
            <div class="container">
                <h2 class="mb-4">Pesanan Saya</h2>
                <div id="orders-container">
                    <!-- Orders will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Order Detail Page -->
        <section id="order-detail-page" class="py-5 d-none">
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <div class="order-tracking">
                            <h3>Detail Pesanan</h3>
                            <div class="order-info">
                                <div>
                                    <h5 id="order-detail-number"></h5>
                                    <p id="order-detail-date"></p>
                                </div>
                                <div>
                                    <span class="status-badge" id="order-detail-status"></span>
                                </div>
                            </div>
                            
                            <div class="order-status">
                                <h4>Status Pesanan</h4>
                                <div class="status-step">
                                    <div class="status-icon completed" id="status-order">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="status-text">
                                        <h5>Pesanan Diterima</h5>
                                        <p id="status-order-time"></p>
                                    </div>
                                </div>
                                <div class="status-step">
                                    <div class="status-icon" id="status-processing">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <div class="status-text">
                                        <h5>Sedang Diproses</h5>
                                        <p id="status-processing-time"></p>
                                    </div>
                                </div>
                                <div class="status-step">
                                    <div class="status-icon" id="status-shipping">
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <div class="status-text">
                                        <h5>Sedang Dikirim</h5>
                                        <p id="status-shipping-time"></p>
                                    </div>
                                </div>
                                <div class="status-step">
                                    <div class="status-icon" id="status-completed">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="status-text">
                                        <h5>Pesanan Selesai</h5>
                                        <p id="status-completed-time"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="order-tracking mt-4">
                            <h3>Informasi Pengiriman</h3>
                            <div class="mb-3">
                                <h5 id="order-detail-name"></h5>
                                <p id="order-detail-phone"></p>
                                <p id="order-detail-address"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="order-summary">
                            <h3>Ringkasan Pesanan</h3>
                            <div id="order-detail-items">
                                <!-- Order items will be loaded here -->
                            </div>
                            <div class="order-total">
                                <span>Total:</span>
                                <span id="order-detail-total"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Login Page -->
        <section id="login-page" class="py-5 d-none">
            <div class="container">
                <div class="login-container">
                    <h2>Login</h2>
                    <form class="login-form" onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-control" id="login-email" placeholder="Email" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" class="form-control" id="login-password" placeholder="Password" required>
                        </div>
                        <button type="submit">Login</button>
                    </form>
                    <div class="text-center mt-3">
                        <p>Belum punya akun? <a href="#" onclick="showPage('register')">Daftar</a></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Register Page -->
        <section id="register-page" class="py-5 d-none">
            <div class="container">
                <div class="login-container">
                    <h2>Daftar</h2>
                    <form class="login-form" onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label>Nama Lengkap</label>
                            <input type="text" class="form-control" id="register-name" placeholder="Nama Lengkap" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-control" id="register-email" placeholder="Email" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" class="form-control" id="register-password" placeholder="Password" required>
                        </div>
                        <div class="form-group">
                            <label>Konfirmasi Password</label>
                            <input type="password" class="form-control" id="register-confirm-password" placeholder="Konfirmasi Password" required>
                        </div>
                        <button type="submit">Daftar</button>
                    </form>
                    <div class="text-center mt-3">
                        <p>Sudah punya akun? <a href="#" onclick="showPage('login')">Login</a></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-dark text-white py-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <h5>Raja Sayur Store</h5>
                        <p>Toko online terpercaya dengan berbagai produk sayuran dan bumbu dapur berkualitas dan harga terjangkau.</p>
                        <div class="social-links mt-3">
                            <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="text-white me-2"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="text-white"><i class="fab fa-whatsapp"></i></a>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h5>Quick Links</h5>
                        <ul class="list-unstyled">
                            <li><a href="#" class="text-white" onclick="showPage('home')">Beranda</a></li>
                            <li><a href="#" class="text-white" onclick="showPage('products')">Produk</a></li>
                            <li><a href="#" class="text-white" onclick="showPage('categories')">Kategori</a></li>
                            <li><a href="#" class="text-white" onclick="showPage('cart')">Keranjang</a></li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h5>Kontak Kami</h5>
                        <p><i class="fas fa-map-marker-alt me-2"></i>Jl. Contoh No. 123, Jakarta</p>
                        <p><i class="fas fa-phone me-2"></i>(021) 12345678</p>
                        <p><i class="fas fa-envelope me-2"></i>info@rajasayur.com</p>
                    </div>
                </div>
                <hr class="my-4 bg-white">
                <div class="text-center">
                    <p>&copy; 2023 Raja Sayur Store. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Chat Widget -->
    <div class="chat-widget" id="chat-widget">
        <div class="chat-header" onclick="toggleChat()">
            <div>
                <i class="fas fa-comments me-2"></i>Live Chat
            </div>
            <div>
                <i class="fas fa-chevron-down" id="chat-toggle-icon"></i>
            </div>
        </div>
        
        <div class="chat-body" id="chat-body">
            <!-- Chat messages will be loaded here -->
        </div>
        
        <div class="chat-form" id="chat-form">
            <input type="text" id="chat-name" placeholder="Nama Anda" required>
            <input type="email" id="chat-email" placeholder="Email Anda" required>
            <button onclick="startChat()">Mulai Chat</button>
        </div>
        
        <div class="chat-input d-none" id="chat-input">
            <input type="text" id="chat-message" placeholder="Ketik pesan..." onkeypress="handleChatKeyPress(event)">
            <button onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="admin-panel">
        <div class="admin-sidebar">
            <div class="sidebar-header">
                <i class="fas fa-store me-2"></i>Raja Sayur Admin
            </div>
            <ul class="admin-menu">
                <li><a href="#" onclick="showAdminPage('dashboard')" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" onclick="showAdminPage('products')"><i class="fas fa-box"></i> Produk</a></li>
                <li><a href="#" onclick="showAdminPage('orders')"><i class="fas fa-shopping-cart"></i> Pesanan</a></li>
                <li><a href="#" onclick="showAdminPage('customers')"><i class="fas fa-users"></i> Pelanggan</a></li>
                <li><a href="#" onclick="showAdminPage('chat')"><i class="fas fa-comments"></i> Live Chat <span class="badge bg-danger" id="admin-chat-notification">0</span></a></li>
                <li><a href="#" onclick="showAdminPage('settings')"><i class="fas fa-cog"></i> Pengaturan</a></li>
                <li><a href="#" onclick="logoutAdmin()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </div>
        <div class="admin-content">
            <div class="admin-header">
                <h2 id="admin-page-title">Dashboard</h2>
                <div>
                    <span id="admin-user-name">Admin</span>
                    <button class="btn btn-sm btn-danger ms-3" onclick="logoutAdmin()">Logout</button>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="admin-dashboard" class="admin-page-content">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-card primary">
                            <div>Total Pesanan</div>
                            <h3 id="total-orders">0</h3>
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card success">
                            <div>Pesanan Selesai</div>
                            <h3 id="completed-orders">0</h3>
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card warning">
                            <div>Total Produk</div>
                            <h3 id="total-products">0</h3>
                            <i class="fas fa-box"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card danger">
                            <div>Total Pelanggan</div>
                            <h3 id="total-customers">0</h3>
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Selamat Datang di Panel Admin</h5>
                            </div>
                            <div class="card-body">
                                <p>Gunakan menu di sebelah kiri untuk mengelola toko online Anda.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Products -->
            <div id="admin-products" class="admin-page-content d-none">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Manajemen Produk</h3>
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus me-2"></i>Tambah Produk
                    </button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Gambar</th>
                                        <th>Nama</th>
                                        <th>Kategori</th>
                                        <th>Harga</th>
                                        <th>Stok</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-products-list">
                                    <!-- Products will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Orders -->
            <div id="admin-orders" class="admin-page-content d-none">
                <h3 class="mb-4">Manajemen Pesanan</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Pelanggan</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Tanggal</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-orders-list">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Customers -->
            <div id="admin-customers" class="admin-page-content d-none">
                <h3 class="mb-4">Manajemen Pelanggan</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nama</th>
                                        <th>Email</th>
                                        <th>Tanggal Daftar</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-customers-list">
                                    <!-- Customers will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Chat -->
            <div id="admin-chat" class="admin-page-content d-none">
                <h3 class="mb-4">Live Chat</h3>
                <div class="card">
                    <div class="card-body p-0">
                        <div class="admin-chat-container">
                            <div class="admin-chat-sidebar" id="admin-chat-sidebar">
                                <!-- Chat users will be loaded here -->
                            </div>
                            <div class="admin-chat-main">
                                <div class="admin-chat-header" id="admin-chat-header">
                                    <img src="https://picsum.photos/seed/user/40/40.jpg" alt="User">
                                    <div>
                                        <div class="fw-bold" id="admin-chat-user-name">Pilih pengguna</div>
                                        <div class="text-muted small" id="admin-chat-user-status">Online</div>
                                    </div>
                                </div>
                                <div class="admin-chat-messages" id="admin-chat-messages">
                                    <div class="text-center text-muted py-5">
                                        <i class="fas fa-comments" style="font-size: 3rem;"></i>
                                        <p class="mt-3">Pilih pengguna untuk memulai chat</p>
                                    </div>
                                </div>
                                <div class="admin-chat-input">
                                    <input type="text" id="admin-chat-message" placeholder="Ketik pesan..." onkeypress="handleAdminChatKeyPress(event)">
                                    <button onclick="sendAdminMessage()">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Settings -->
            <div id="admin-settings" class="admin-page-content d-none">
                <h3 class="mb-4">Pengaturan</h3>
                <div class="card">
                    <div class="card-body">
                        <form>
                            <div class="mb-3">
                                <label class="form-label">Nama Toko</label>
                                <input type="text" class="form-control" value="Raja Sayur Store">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" value="info@rajasayur.com">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Telepon</label>
                                <input type="tel" class="form-control" value="(021) 12345678">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Alamat</label>
                                <textarea class="form-control">Jl. Contoh No. 123, Jakarta</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    
    <script>
        // Tunggu hingga semua skrip dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyBuG-LxK6rDzVp2-om_hhGiwOn2XpLmceE",
                authDomain: "rajasayur-store.firebaseapp.com",
                projectId: "rajasayur-store",
                storageBucket: "rajasayur-store.firebasestorage.app",
                messagingSenderId: "34641740873",
                appId: "1:34641740873:web:e9fb6c9a2279b275006b98",
                measurementId: "G-NV9HHZ22FG"
            };

            try {
                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                
                // Initialize services
                const db = firebase.firestore();
                const auth = firebase.auth();
                
                // Set global variables
                window.db = db;
                window.auth = auth;
                window.firebaseAvailable = true;
                
                console.log("Firebase initialized successfully");
                
                // Initialize app after Firebase is ready
                initializeApp();
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                window.firebaseAvailable = false;
                
                // Initialize app without Firebase
                initializeApp();
            }
        });

        // Initialize app function
        function initializeApp() {
            // Data produk
            const products = [
                {
                    id: 1,
                    name: "Tomat Segar",
                    category: "sayuran",
                    price: 15000,
                    stock: 50,
                    image: "https://images.unsplash.com/photo-1512926584220-7c693e6533d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    description: "Tomat segar berkualitas tinggi, langsung dari petani."
                },
                {
                    id: 2,
                    name: "Wortel Organik",
                    category: "organik",
                    price: 12000,
                    stock: 40,
                    image: "https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    description: "Wortel organik tanpa pestisida, kaya akan vitamin A."
                },
                {
                    id: 3,
                    name: "Bawang Merah",
                    category: "bumbu",
                    price: 25000,
                    stock: 30,
                    image: "https://images.unsplash.com/photo-1602877306277-4e0a9d70c6e6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    description: "Bawang merah pilihan untuk masakan lezat."
                },
                {
                    id: 4,
                    name: "Bayam Premium",
                    category: "premium",
                    price: 10000,
                    stock: 25,
                    image: "https://images.unsplash.com/photo-1576042758248-4b703f7f0d5a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    description: "Bayam premium segar, kaya akan nutrisi."
                },
                {
                    id: 5,
                    name: "Cabai Merah",
                    category: "bumbu",
                    price: 30000,
                    stock: 20,
                    image: "https://images.unsplash.com/photo-1594736797933-d0eb1ff2e2d6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    description: "Cabai merah pedas, cocok untuk berbagai masakan."
                },
                {
                    id: 6,
                    name: "Brokoli Organik",
                    category: "organik",
                    price: 20000,
                    stock: 15,
                    image: "https://images.unsplash.com/photo-1519162584292-56dfc9eb5db4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                    description: "Brokoli organik segar, tinggi serat dan vitamin C."
                }
            ];

            // Data keranjang
            let cart = [];

            // Data pengguna
            let users = [
                {
                    id: 1,
                    name: "Admin User",
                    email: "admin@rajasayur.com",
                    password: "admin123",
                    isAdmin: true
                },
                {
                    id: 2,
                    name: "Test User",
                    email: "user@example.com",
                    password: "user123",
                    isAdmin: false
                }
            ];

            // Data pesanan
            let orders = [];

            // Data pengguna yang sedang login
            let currentUser = null;

            // Data chat
            let chatUsers = [];
            let chatMessages = {};
            let currentChatUser = null;
            let chatUser = null;

            // Variabel global untuk status admin
            let adminOnline = false;
            let lastAdminActivity = new Date().getTime();

            // Variabel global untuk typing indicator
            let typingIndicators = {};

            // Fungsi-fungsi krusial yang harus tersedia segera
            function showPage(pageId) {
                // Sembunyikan semua halaman
                const pages = document.querySelectorAll('section');
                pages.forEach(page => {
                    page.classList.add('d-none');
                });
                
                // Tampilkan halaman yang dipilih
                const selectedPage = document.getElementById(`${pageId}-page`);
                if (selectedPage) {
                    selectedPage.classList.remove('d-none');
                } else if (pageId === 'home') {
                    document.getElementById('home-page').classList.remove('d-none');
                }
                
                // Jika halaman produk, tampilkan semua produk
                if (pageId === 'products') {
                    displayAllProducts();
                }
                
                // Jika halaman keranjang, tampilkan isi keranjang
                if (pageId === 'cart') {
                    displayCart();
                }
                
                // Jika halaman pesanan, tampilkan daftar pesanan
                if (pageId === 'orders') {
                    displayOrders();
                }
            }

            function showAdminLogin() {
                // Buat modal untuk login admin
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'adminLoginModal';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Login Admin</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="admin-email" value="admin@rajasayur.com" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Password</label>
                                        <input type="password" class="form-control" id="admin-password" value="admin123" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Login</button>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Tampilkan modal
                const adminLoginModal = new bootstrap.Modal(document.getElementById('adminLoginModal'));
                adminLoginModal.show();
                
                // Hapus modal setelah ditutup
                document.getElementById('adminLoginModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }

            // Cek apakah Firebase sudah diinisialisasi
            if (window.db && window.auth) {
                console.log("Firebase loaded successfully");
            } else {
                console.error("Firebase not loaded");
            }

            // Fungsi untuk mengecek koneksi Firebase
            function checkFirebaseConnection() {
                if (!window.firebaseAvailable || !window.db) return false;
                
                try {
                    // Coba koneksi ke Firebase
                    window.db.collection('connection').doc('test').set({
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        console.log("Firebase connection successful");
                        return true;
                    }).catch(error => {
                        console.error('Firebase connection failed:', error);
                        window.firebaseAvailable = false;
                        return false;
                    });
                } catch (error) {
                    console.error('Error checking Firebase connection:', error);
                    window.firebaseAvailable = false;
                    return false;
                }
            }

            // Fungsi untuk menampilkan indikator koneksi
            function showConnectionIndicator() {
                const indicator = document.createElement('div');
                indicator.id = 'connection-indicator';
                
                if (window.firebaseAvailable) {
                    indicator.textContent = 'Terhubung';
                    indicator.style.backgroundColor = '#28a745';
                } else {
                    indicator.textContent = 'Tidak terhubung';
                    indicator.style.backgroundColor = '#dc3545';
                }
                
                document.body.appendChild(indicator);
                
                // Update indikator setiap 5 detik
                setInterval(() => {
                    if (window.firebaseAvailable) {
                        indicator.textContent = 'Terhubung';
                        indicator.style.backgroundColor = '#28a745';
                    } else {
                        indicator.textContent = 'Tidak terhubung';
                        indicator.style.backgroundColor = '#dc3545';
                    }
                }, 5000);
            }

            // Setup listeners untuk real-time updates
            function setupRealtimeListeners() {
                if (!window.firebaseAvailable || !window.db) return;
                
                try {
                    // Listener untuk chat messages
                    window.db.collection('chatMessages').onSnapshot((snapshot) => {
                        snapshot.docChanges().forEach((change) => {
                            if (change.type === 'added' || change.type === 'modified') {
                                const data = change.doc.data();
                                chatMessages[change.doc.id] = data.messages || [];
                                
                                // Update UI jika perlu
                                if (document.getElementById('admin-panel').style.display !== 'none') {
                                    displayAdminChat();
                                }
                                
                                // Update chat widget jika pengguna sedang aktif
                                if (chatUser && chatUser.id == change.doc.id) {
                                    loadChatMessages(chatUser.id);
                                }
                            }
                        });
                    });
                    
                    // Listener untuk orders
                    window.db.collection('orders').onSnapshot((snapshot) => {
                        snapshot.docChanges().forEach((change) => {
                            if (change.type === 'added') {
                                const order = change.doc.data();
                                
                                // Cek apakah order sudah ada di array
                                const existingIndex = orders.findIndex(o => o.id === order.id);
                                if (existingIndex === -1) {
                                    orders.push(order);
                                    
                                    // Tampilkan notifikasi browser
                                    showBrowserNotification(
                                        "Pesanan Baru #" + order.id,
                                        "Pelanggan: " + order.customerName + ", Total: Rp " + order.total.toLocaleString('id-ID'),
                                        "https://badok16.github.io/Raja-Sayur-Store/favicon.ico"
                                    );
                                }
                                
                                // Update UI jika perlu
                                if (document.getElementById('admin-panel').style.display !== 'none') {
                                    updateAdminDashboard();
                                    displayAdminOrders();
                                }
                                
                                // Update order list jika pengguna sedang melihat pesanan
                                if (document.getElementById('orders-page').classList.contains('d-none') === false) {
                                    displayOrders();
                                }
                            } else if (change.type === 'modified') {
                                const order = change.doc.data();
                                const index = orders.findIndex(o => o.id === order.id);
                                if (index !== -1) {
                                    orders[index] = order;
                                    
                                    // Tampilkan notifikasi untuk perubahan status
                                    if (orders[index].status !== order.status) {
                                        showBrowserNotification(
                                            "Update Pesanan #" + order.id,
                                            "Status diubah menjadi: " + getStatusText(order.status),
                                            "https://badok16.github.io/Raja-Sayur-Store/favicon.ico"
                                        );
                                    }
                                    
                                    // Update UI jika perlu
                                    if (document.getElementById('admin-panel').style.display !== 'none') {
                                        displayAdminOrders();
                                    }
                                    
                                    // Update order detail jika sedang dilihat
                                    if (document.getElementById('order-detail-page').classList.contains('d-none') === false) {
                                        const orderId = parseInt(document.getElementById('order-detail-number').textContent.replace('#', ''));
                                        if (orderId === order.id) {
                                            showOrderDetail(orderId);
                                        }
                                    }
                                }
                            }
                        });
                    });
                    
                    // Listener untuk admin status
                    window.db.collection('adminStatus').doc('status').onSnapshot((doc) => {
                        if (doc.exists) {
                            const data = doc.data();
                            adminOnline = data.online || false;
                            lastAdminActivity = data.lastActivity || 0;
                            
                            // Cek apakah admin masih aktif (aktif dalam 5 menit terakhir)
                            const now = new Date().getTime();
                            const fiveMinutes = 5 * 60 * 1000;
                            
                            if (now - lastAdminActivity > fiveMinutes) {
                                adminOnline = false;
                            }
                            
                            // Update UI
                            updateAdminStatusUI();
                        }
                    });
                    
                    console.log("Realtime listeners setup successfully");
                } catch (error) {
                    console.error('Error setting up realtime listeners:', error);
                    window.firebaseAvailable = false;
                }
            }

            // Fungsi untuk memuat data pesanan
            function loadOrdersData() {
                if (window.firebaseAvailable && window.db) {
                    // Gunakan Firebase
                    window.db.collection('orders').get().then(snapshot => {
                        orders = [];
                        snapshot.forEach(doc => {
                            orders.push(doc.data());
                        });
                    }).catch(error => {
                        console.error('Error loading orders from Firebase:', error);
                        // Fallback ke localStorage
                        loadOrdersFromLocalStorage();
                    });
                } else {
                    // Gunakan localStorage
                    loadOrdersFromLocalStorage();
                }
            }

            // Fungsi untuk memuat data pesanan dari localStorage
            function loadOrdersFromLocalStorage() {
                const savedOrders = localStorage.getItem('orders');
                if (savedOrders) {
                    try {
                        orders = JSON.parse(savedOrders);
                    } catch (error) {
                        console.error('Error parsing orders from localStorage:', error);
                        orders = [];
                    }
                }
            }

            // Fungsi untuk menyimpan data pesanan
            function saveOrdersData() {
                if (window.firebaseAvailable && window.db) {
                    // Gunakan Firebase
                    orders.forEach(order => {
                        window.db.collection('orders').doc(order.id.toString()).set(order)
                            .catch(error => {
                                console.error('Error saving order to Firebase:', error);
                            });
                    });
                }
                
                // Selalu simpan ke localStorage sebagai backup
                localStorage.setItem('orders', JSON.stringify(orders));
            }

            // Fungsi untuk memuat data chat
            function loadChatData() {
                if (window.firebaseAvailable && window.db) {
                    // Gunakan Firebase
                    // Muat chat users
                    window.db.collection('chatUsers').get().then(snapshot => {
                        chatUsers = [];
                        snapshot.forEach(doc => {
                            chatUsers.push(doc.data());
                        });
                    }).catch(error => {
                        console.error('Error loading chat users from Firebase:', error);
                        // Fallback ke localStorage
                        loadChatFromLocalStorage();
                    });
                    
                    // Muat chat messages
                    window.db.collection('chatMessages').get().then(snapshot => {
                        chatMessages = {};
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            chatMessages[doc.id] = data.messages || [];
                        });
                    }).catch(error => {
                        console.error('Error loading chat messages from Firebase:', error);
                        // Fallback ke localStorage
                        loadChatFromLocalStorage();
                    });
                } else {
                    // Gunakan localStorage
                    loadChatFromLocalStorage();
                }
            }

            // Fungsi untuk memuat data chat dari localStorage
            function loadChatFromLocalStorage() {
                try {
                    const savedChatUsers = localStorage.getItem('chatUsers');
                    const savedChatMessages = localStorage.getItem('chatMessages');
                    
                    if (savedChatUsers) {
                        chatUsers = JSON.parse(savedChatUsers);
                    }
                    
                    if (savedChatMessages) {
                        chatMessages = JSON.parse(savedChatMessages);
                    }
                } catch (error) {
                    console.error('Error parsing chat data from localStorage:', error);
                    chatUsers = [];
                    chatMessages = {};
                }
            }

            // Fungsi untuk menyimpan data chat
            function saveChatData() {
                if (window.firebaseAvailable && window.db) {
                    // Simpan chat users
                    chatUsers.forEach(user => {
                        window.db.collection('chatUsers').doc(user.id.toString()).set(user)
                            .catch(error => {
                                console.error('Error saving chat user to Firebase:', error);
                            });
                    });
                    
                    // Simpan chat messages
                    Object.keys(chatMessages).forEach(userId => {
                        window.db.collection('chatMessages').doc(userId).set({
                            messages: chatMessages[userId]
                        }).catch(error => {
                            console.error('Error saving chat messages to Firebase:', error);
                        });
                    });
                }
                
                // Selalu simpan ke localStorage sebagai backup
                localStorage.setItem('chatUsers', JSON.stringify(chatUsers));
                localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
            }

            // Fungsi untuk menampilkan notifikasi di browser
            function showBrowserNotification(title, body, icon) {
                if (!("Notification" in window)) {
                    console.log("Browser tidak mendukung notifikasi");
                    return;
                }
                
                if (Notification.permission === "granted") {
                    const notification = new Notification(title, {
                        body: body,
                        icon: icon || "https://badok16.github.io/Raja-Sayur-Store/favicon.ico"
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        notification.close();
                        
                        // Buka halaman admin jika belum dibuka
                        if (document.getElementById('admin-panel').style.display === 'none') {
                            showAdminLogin();
                        }
                        
                        // Buka halaman chat
                        showAdminPage('chat');
                    };
                } else if (Notification.permission !== "denied") {
                    Notification.requestPermission().then(function (permission) {
                        if (permission === "granted") {
                            showBrowserNotification(title, body, icon);
                        }
                    });
                }
            }

            // Fungsi helper untuk mendapatkan teks status
            function getStatusText(status) {
                switch (status) {
                    case 'processing':
                        return 'Sedang Diproses';
                    case 'shipping':
                        return 'Sedang Dikirim';
                    case 'completed':
                        return 'Selesai';
                    default:
                        return status;
                }
            }

            // Fungsi untuk memperbarui status admin
            function updateAdminStatus() {
                if (!window.firebaseAvailable || !window.db) return;
                
                try {
                    // Update status admin menjadi online
                    adminOnline = true;
                    lastAdminActivity = new Date().getTime();
                    
                    // Simpan status admin ke Firebase
                    window.db.collection('adminStatus').doc('status').set({
                        online: adminOnline,
                        lastActivity: lastAdminActivity
                    }).catch(error => {
                        console.error('Error updating admin status:', error);
                    });
                    
                    console.log("Admin status updated to online");
                } catch (error) {
                    console.error('Error updating admin status:', error);
                }
            }

            // Fungsi untuk mengecek status admin
            function checkAdminStatus() {
                if (!window.firebaseAvailable || !window.db) return;
                
                try {
                    // Ambil status admin dari Firebase
                    window.db.collection('adminStatus').doc('status').get().then(doc => {
                        if (doc.exists) {
                            const data = doc.data();
                            adminOnline = data.online;
                            lastAdminActivity = data.lastActivity;
                            
                            // Cek apakah admin masih aktif (aktif dalam 5 menit terakhir)
                            const now = new Date().getTime();
                            const fiveMinutes = 5 * 60 * 1000;
                            
                            if (now - lastAdminActivity > fiveMinutes) {
                                adminOnline = false;
                            }
                            
                            // Update UI
                            updateAdminStatusUI();
                        }
                    }).catch(error => {
                        console.error('Error checking admin status:', error);
                    });
                } catch (error) {
                    console.error('Error checking admin status:', error);
                }
            }

            // Fungsi untuk memperbarui UI status admin
            function updateAdminStatusUI() {
                const statusElement = document.getElementById('admin-chat-user-status');
                if (statusElement) {
                    if (adminOnline) {
                        statusElement.textContent = 'Online';
                        statusElement.classList.remove('text-danger');
                        statusElement.classList.add('text-success');
                    } else {
                        statusElement.textContent = 'Offline';
                        statusElement.classList.remove('text-success');
                        statusElement.classList.add('text-danger');
                    }
                }
            }

            // Fungsi untuk menampilkan indikator mengetik
            function showTypingIndicator(userId, isTyping) {
                typingIndicators[userId] = isTyping;
                
                if (chatUser && chatUser.id === userId) {
                    const chatBody = document.getElementById('chat-body');
                    
                    // Cek apakah sudah ada indikator mengetik
                    let typingIndicator = document.getElementById('typing-indicator');
                    
                    if (isTyping && !typingIndicator) {
                        // Buat indikator mengetik
                        typingIndicator = document.createElement('div');
                        typingIndicator.id = 'typing-indicator';
                        typingIndicator.className = 'chat-message admin typing-indicator';
                        typingIndicator.innerHTML = `
                            <div class="chat-bubble">
                                <div class="typing-dots">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        `;
                        
                        chatBody.appendChild(typingIndicator);
                        chatBody.scrollTop = chatBody.scrollHeight;
                    } else if (!isTyping && typingIndicator) {
                        // Hapus indikator mengetik
                        chatBody.removeChild(typingIndicator);
                    }
                }
                
                if (currentChatUser && currentChatUser.id === userId) {
                    const adminChatMessages = document.getElementById('admin-chat-messages');
                    
                    // Cek apakah sudah ada indikator mengetik
                    let typingIndicator = document.getElementById('admin-typing-indicator');
                    
                    if (isTyping && !typingIndicator) {
                        // Buat indikator mengetik
                        typingIndicator = document.createElement('div');
                        typingIndicator.id = 'admin-typing-indicator';
                        typingIndicator.className = 'chat-message user typing-indicator';
                        typingIndicator.innerHTML = `
                            <div class="chat-bubble">
                                <div class="typing-dots">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        `;
                        
                        adminChatMessages.appendChild(typingIndicator);
                        adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
                    } else if (!isTyping && typingIndicator) {
                        // Hapus indikator mengetik
                        adminChatMessages.removeChild(typingIndicator);
                    }
                }
            }

            // Fungsi untuk memperbarui status typing
            function updateTypingStatus(userId, isTyping) {
                if (!window.firebaseAvailable || !window.db) return;
                
                try {
                    // Simpan status typing ke Firebase
                    window.db.collection('typingStatus').doc(userId.toString()).set({
                        isTyping: isTyping,
                        timestamp: new Date().getTime()
                    }).catch(error => {
                        console.error('Error updating typing status:', error);
                    });
                } catch (error) {
                    console.error('Error updating typing status:', error);
                }
            }

            // Fungsi untuk mengecek apakah admin sedang aktif
            function isAdminActive() {
                // Logika untuk mengecek apakah admin sedang online
                // Untuk sekarang, kita asumsikan admin selalu aktif
                return true;
            }

            // Fungsi untuk mengirim auto-response
            function sendAutoResponse(userId) {
                const responses = [
                    "Terima kasih telah menghubungi kami. Admin akan segera merespons pesan Anda.",
                    "Pesan Anda telah kami terima. Mohon tunggu beberapa saat untuk respons dari admin.",
                    "Terima kasih atas pesan Anda. Tim kami akan segera membantu Anda."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                const message = {
                    text: randomResponse,
                    sender: 'admin',
                    timestamp: new Date().toISOString(),
                    isAutoResponse: true
                };
                
                // Add to messages
                if (!chatMessages[userId]) {
                    chatMessages[userId] = [];
                }
                
                chatMessages[userId].push(message);
                
                // Save data
                saveChatData();
                
                // Reload messages if this user is currently active
                if (chatUser && chatUser.id === userId) {
                    loadChatMessages(userId);
                }
                
                // Update admin chat notification
                updateChatNotification();
            }

            // Tampilkan produk unggulan di halaman beranda
            function displayFeaturedProducts() {
                const featuredProductsContainer = document.getElementById('featured-products');
                featuredProductsContainer.innerHTML = '';
                
                // Ambil 4 produk pertama sebagai produk unggulan
                const featuredProducts = products.slice(0, 4);
                
                featuredProducts.forEach(product => {
                    const productCard = createProductCard(product);
                    featuredProductsContainer.appendChild(productCard);
                });
            }

            // Fungsi untuk menampilkan semua produk
            function displayAllProducts() {
                const productsContainer = document.getElementById('products-container');
                productsContainer.innerHTML = '';
                
                products.forEach(product => {
                    const productCard = createProductCard(product);
                    productsContainer.appendChild(productCard);
                });
            }

            // Fungsi untuk membuat kartu produk
            function createProductCard(product) {
                const col = document.createElement('div');
                col.className = 'col-md-4 col-sm-6 mb-4';
                
                const card = document.createElement('div');
                card.className = 'card product-card';
                
                const img = document.createElement('img');
                img.className = 'card-img-top';
                img.src = product.image;
                img.alt = product.name;
                
                const cardBody = document.createElement('div');
                cardBody.className = 'card-body';
                
                const title = document.createElement('h5');
                title.className = 'card-title';
                title.textContent = product.name;
                
                const description = document.createElement('p');
                description.className = 'card-text';
                description.textContent = product.description;
                
                const price = document.createElement('div');
                price.className = 'product-price';
                price.textContent = `Rp ${product.price.toLocaleString('id-ID')}`;
                
                const button = document.createElement('button');
                button.className = 'btn btn-primary';
                button.textContent = 'Tambah ke Keranjang';
                button.onclick = function() {
                    addToCartFromCard(product);
                };
                
                cardBody.appendChild(title);
                cardBody.appendChild(description);
                cardBody.appendChild(price);
                cardBody.appendChild(button);
                
                card.appendChild(img);
                card.appendChild(cardBody);
                
                col.appendChild(card);
                
                return col;
            }

            // Fungsi untuk menambah produk ke keranjang dari kartu
            function addToCartFromCard(product) {
                const existingItem = cart.find(item => item.id === product.id);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        image: product.image,
                        quantity: 1
                    });
                }
                
                updateCartCount();
                
                // Tampilkan notifikasi
                showNotification('Produk berhasil ditambahkan ke keranjang!');
            }

            // Fungsi untuk memperbarui jumlah keranjang
            function updateCartCount() {
                const cartCount = document.getElementById('cart-count');
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                cartCount.textContent = totalItems;
            }

            // Fungsi untuk menampilkan keranjang
            function displayCart() {
                const cartContainer = document.getElementById('cart-container');
                cartContainer.innerHTML = '';
                
                if (cart.length === 0) {
                    cartContainer.innerHTML = `
                        <div class="text-center py-5">
                            <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ccc;"></i>
                            <h3 class="mt-3">Keranjang Belanja Kosong</h3>
                            <p class="text-muted">Tambahkan produk ke keranjang Anda</p>
                            <a href="#" class="btn btn-primary" onclick="showPage('products')">Belanja Sekarang</a>
                        </div>
                    `;
                    return;
                }
                
                const table = document.createElement('table');
                table.className = 'cart-table';
                
                const thead = document.createElement('thead');
                thead.innerHTML = `
                    <tr>
                        <th>Produk</th>
                        <th>Harga</th>
                        <th>Jumlah</th>
                        <th>Total</th>
                        <th>Aksi</th>
                    </tr>
                `;
                
                const tbody = document.createElement('tbody');
                
                let grandTotal = 0;
                
                cart.forEach(item => {
                    const total = item.price * item.quantity;
                    grandTotal += total;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${item.image}" alt="${item.name}" class="me-3">
                                <div>
                                    <h6>${item.name}</h6>
                                </div>
                            </div>
                        </td>
                        <td>Rp ${item.price.toLocaleString('id-ID')}</td>
                        <td>
                            <div class="quantity-control">
                                <button onclick="updateCartItemQuantity(${item.id}, -1)">-</button>
                                <input type="number" value="${item.quantity}" min="1" readonly>
                                <button onclick="updateCartItemQuantity(${item.id}, 1)">+</button>
                            </div>
                        </td>
                        <td>Rp ${total.toLocaleString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removeFromCart(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                table.appendChild(thead);
                table.appendChild(tbody);
                
                cartContainer.appendChild(table);
                
                const cartTotal = document.createElement('div');
                cartTotal.className = 'cart-total';
                cartTotal.innerHTML = `
                    <p>Total: <strong>Rp ${grandTotal.toLocaleString('id-ID')}</strong></p>
                `;
                
                cartContainer.appendChild(cartTotal);
                
                const checkoutButton = document.createElement('div');
                checkoutButton.className = 'text-center mt-4';
                checkoutButton.innerHTML = `
                    <button class="btn btn-primary btn-lg" onclick="proceedToCheckout()">Checkout</button>
                `;
                
                cartContainer.appendChild(checkoutButton);
            }

            // Fungsi untuk memperbarui jumlah item di keranjang
            function updateCartItemQuantity(productId, change) {
                const item = cart.find(item => item.id === productId);
                
                if (item) {
                    item.quantity += change;
                    
                    if (item.quantity <= 0) {
                        removeFromCart(productId);
                    } else {
                        updateCartCount();
                        displayCart();
                    }
                }
            }

            // Fungsi untuk menghapus item dari keranjang
            function removeFromCart(productId) {
                cart = cart.filter(item => item.id !== productId);
                updateCartCount();
                displayCart();
                showNotification('Produk berhasil dihapus dari keranjang!');
            }

            // Fungsi untuk melanjutkan ke checkout
            function proceedToCheckout() {
                if (cart.length === 0) {
                    showNotification('Keranjang belanja kosong!', 'error');
                    return;
                }
                
                showPage('checkout');
                displayOrderSummary();
            }

            // Fungsi untuk menampilkan ringkasan pesanan di checkout
            function displayOrderSummary() {
                const orderSummaryItems = document.getElementById('order-summary-items');
                orderSummaryItems.innerHTML = '';
                
                let grandTotal = 0;
                
                cart.forEach(item => {
                    const total = item.price * item.quantity;
                    grandTotal += total;
                    
                    const orderItem = document.createElement('div');
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <span>${item.name} x ${item.quantity}</span>
                        <span>Rp ${total.toLocaleString('id-ID')}</span>
                    `;
                    
                    orderSummaryItems.appendChild(orderItem);
                });
                
                document.getElementById('order-total-price').textContent = `Rp ${grandTotal.toLocaleString('id-ID')}`;
            }

            // Fungsi untuk melakukan pemesanan
            function placeOrder() {
                // Validasi form
                const name = document.getElementById('checkout-name').value.trim();
                const phone = document.getElementById('checkout-phone').value.trim();
                const address = document.getElementById('checkout-address').value.trim();
                const city = document.getElementById('checkout-city').value.trim();
                
                if (!name || !phone || !address || !city) {
                    showNotification('Harap lengkapi semua field yang diperlukan!', 'error');
                    return;
                }
                
                // Hitung total
                let grandTotal = 0;
                cart.forEach(item => {
                    grandTotal += item.price * item.quantity;
                });
                
                // Buat pesanan baru
                const order = {
                    id: Date.now(),
                    customerName: name,
                    customerPhone: phone,
                    customerAddress: `${address}, ${city}`,
                    items: [...cart],
                    total: grandTotal,
                    paymentMethod: document.querySelector('input[name="payment-method"]:checked').value,
                    status: 'processing',
                    date: new Date().toISOString(),
                    statusHistory: [
                        {
                            status: 'order',
                            timestamp: new Date().toISOString(),
                            note: 'Pesanan diterima'
                        }
                    ]
                };
                
                // Tambahkan ke daftar pesanan
                orders.push(order);
                
                // Simpan data
                saveOrdersData();
                
                // Kosongkan keranjang
                cart = [];
                updateCartCount();
                
                // Tampilkan halaman sukses
                document.getElementById('order-number').textContent = `#${order.id}`;
                showPage('order-success');
                
                // Simulasi perubahan status pesanan
                simulateOrderStatusChange(order.id);
            }

            // Fungsi untuk mensimulasikan perubahan status pesanan
            function simulateOrderStatusChange(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                // Simulasi perubahan status setelah beberapa detik
                setTimeout(() => {
                    order.status = 'processing';
                    order.statusHistory.push({
                        status: 'processing',
                        timestamp: new Date().toISOString(),
                        note: 'Pesanan sedang diproses'
                    });
                    saveOrdersData();
                }, 5000);
                
                setTimeout(() => {
                    order.status = 'shipping';
                    order.statusHistory.push({
                        status: 'shipping',
                        timestamp: new Date().toISOString(),
                        note: 'Pesanan sedang dikirim'
                    });
                    saveOrdersData();
                }, 10000);
                
                setTimeout(() => {
                    order.status = 'completed';
                    order.statusHistory.push({
                        status: 'completed',
                        timestamp: new Date().toISOString(),
                        note: 'Pesanan selesai'
                    });
                    saveOrdersData();
                }, 15000);
            }

            // Fungsi untuk menampilkan daftar pesanan
            function displayOrders() {
                const ordersContainer = document.getElementById('orders-container');
                ordersContainer.innerHTML = '';
                
                if (orders.length === 0) {
                    ordersContainer.innerHTML = `
                        <div class="text-center py-5">
                            <i class="fas fa-receipt" style="font-size: 3rem; color: #ccc;"></i>
                            <h3 class="mt-3">Belum Ada Pesanan</h3>
                            <p class="text-muted">Anda belum memiliki pesanan</p>
                            <a href="#" class="btn btn-primary" onclick="showPage('products')">Belanja Sekarang</a>
                        </div>
                    `;
                    return;
                }
                
                orders.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'card mb-3';
                    
                    const statusClass = order.status === 'processing' ? 'processing' : 
                                       order.status === 'shipping' ? 'shipping' : 'completed';
                    
                    const statusText = order.status === 'processing' ? 'Sedang Diproses' : 
                                     order.status === 'shipping' ? 'Sedang Dikirim' : 'Selesai';
                    
                    orderCard.innerHTML = `
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title">Pesanan #${order.id}</h5>
                                    <p class="card-text text-muted">${new Date(order.date).toLocaleDateString('id-ID')}</p>
                                </div>
                                <div>
                                    <span class="status-badge ${statusClass}">${statusText}</span>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div>
                                    <p class="mb-0"><strong>Total:</strong> Rp ${order.total.toLocaleString('id-ID')}</p>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary" onclick="showOrderDetail(${order.id})">
                                        Lihat Detail
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    ordersContainer.appendChild(orderCard);
                });
            }

            // Fungsi untuk menampilkan detail pesanan
            function showOrderDetail(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                // Set data pesanan
                document.getElementById('order-detail-number').textContent = `#${order.id}`;
                document.getElementById('order-detail-date').textContent = new Date(order.date).toLocaleString('id-ID');
                
                const statusClass = order.status === 'processing' ? 'processing' : 
                                   order.status === 'shipping' ? 'shipping' : 'completed';
                
                const statusText = order.status === 'processing' ? 'Sedang Diproses' : 
                                 order.status === 'shipping' ? 'Sedang Dikirim' : 'Selesai';
                
                const statusBadge = document.getElementById('order-detail-status');
                statusBadge.textContent = statusText;
                statusBadge.className = `status-badge ${statusClass}`;
                
                // Set informasi pengiriman
                document.getElementById('order-detail-name').textContent = order.customerName;
                document.getElementById('order-detail-phone').textContent = order.customerPhone;
                document.getElementById('order-detail-address').textContent = order.customerAddress;
                
                // Set ringkasan pesanan
                const orderDetailItems = document.getElementById('order-detail-items');
                orderDetailItems.innerHTML = '';
                
                order.items.forEach(item => {
                    const total = item.price * item.quantity;
                    
                    const orderItem = document.createElement('div');
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <span>${item.name} x ${item.quantity}</span>
                        <span>Rp ${total.toLocaleString('id-ID')}</span>
                    `;
                    
                    orderDetailItems.appendChild(orderItem);
                });
                
                document.getElementById('order-detail-total').textContent = `Rp ${order.total.toLocaleString('id-ID')}`;
                
                // Set status history
                updateOrderStatusHistory(order.statusHistory);
                
                // Tampilkan halaman detail
                showPage('order-detail');
            }

            // Fungsi untuk memperbarui riwayat status pesanan
            function updateOrderStatusHistory(statusHistory) {
                statusHistory.forEach(status => {
                    const statusElement = document.getElementById(`status-${status.status}`);
                    const timeElement = document.getElementById(`status-${status.status}-time`);
                    
                    if (statusElement) {
                        statusElement.classList.add('completed');
                    }
                    
                    if (timeElement) {
                        timeElement.textContent = new Date(status.timestamp).toLocaleString('id-ID');
                    }
                });
            }

            // Fungsi untuk menampilkan produk berdasarkan kategori
            function showProductsByCategory(category) {
                showPage('products');
                
                // Filter produk berdasarkan kategori
                const filteredProducts = products.filter(product => product.category === category);
                
                // Tampilkan produk yang difilter
                const productsContainer = document.getElementById('products-container');
                productsContainer.innerHTML = '';
                
                filteredProducts.forEach(product => {
                    const productCard = createProductCard(product);
                    productsContainer.appendChild(productCard);
                });
                
                // Set nilai filter kategori
                document.getElementById('category-filter').value = category;
            }

            // Fungsi untuk filter produk
            function filterProducts() {
                const category = document.getElementById('category-filter').value;
                
                if (category === '') {
                    displayAllProducts();
                } else {
                    showProductsByCategory(category);
                }
            }

            // Fungsi untuk mengurutkan produk
            function sortProducts() {
                const sortBy = document.getElementById('sort-filter').value;
                let sortedProducts = [...products];
                
                switch (sortBy) {
                    case 'price-asc':
                        sortedProducts.sort((a, b) => a.price - b.price);
                        break;
                    case 'price-desc':
                        sortedProducts.sort((a, b) => b.price - a.price);
                        break;
                    case 'name':
                        sortedProducts.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    default:
                        sortedProducts = [...products];
                }
                
                // Tampilkan produk yang sudah diurutkan
                const productsContainer = document.getElementById('products-container');
                productsContainer.innerHTML = '';
                
                sortedProducts.forEach(product => {
                    const productCard = createProductCard(product);
                    productsContainer.appendChild(productCard);
                });
            }

            // Fungsi untuk mencari produk
            function searchProducts() {
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                
                if (searchTerm === '') {
                    displayAllProducts();
                    return;
                }
                
                const filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) || 
                    product.description.toLowerCase().includes(searchTerm)
                );
                
                // Tampilkan produk yang difilter
                const productsContainer = document.getElementById('products-container');
                productsContainer.innerHTML = '';
                
                filteredProducts.forEach(product => {
                    const productCard = createProductCard(product);
                    productsContainer.appendChild(productCard);
                });
            }

            // Fungsi untuk menampilkan detail produk
            function showProductDetail(productId) {
                const product = products.find(p => p.id === productId);
                
                if (product) {
                    document.getElementById('product-detail-image').src = product.image;
                    document.getElementById('product-detail-name').textContent = product.name;
                    document.getElementById('product-detail-price').textContent = `Rp ${product.price.toLocaleString('id-ID')}`;
                    document.getElementById('product-detail-description').textContent = product.description;
                    document.getElementById('product-quantity').value = 1;
                    
                    // Simpan ID produk untuk digunakan saat menambah ke keranjang
                    document.getElementById('product-detail-page').dataset.productId = productId;
                    
                    showPage('product-detail');
                }
            }

            // Fungsi untuk menambahkan ke keranjang dari halaman detail produk
            function addToCart() {
                const productId = parseInt(document.getElementById('product-detail-page').dataset.productId);
                const product = products.find(p => p.id === productId);
                const quantity = parseInt(document.getElementById('product-quantity').value);
                
                if (product) {
                    const existingItem = cart.find(item => item.id === productId);
                    
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        cart.push({
                            id: product.id,
                            name: product.name,
                            price: product.price,
                            image: product.image,
                            quantity: quantity
                        });
                    }
                    
                    updateCartCount();
                    showNotification('Produk berhasil ditambahkan ke keranjang!');
                }
            }

            // Fungsi untuk membeli sekarang
            function buyNow() {
                addToCart();
                showPage('cart');
            }

            // Fungsi untuk mengurangi jumlah produk
            function decreaseQuantity() {
                const quantityInput = document.getElementById('product-quantity');
                const currentValue = parseInt(quantityInput.value);
                
                if (currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                }
            }

            // Fungsi untuk menambah jumlah produk
            function increaseQuantity() {
                const quantityInput = document.getElementById('product-quantity');
                const currentValue = parseInt(quantityInput.value);
                quantityInput.value = currentValue + 1;
            }

            // Fungsi untuk menangani login
            function handleLogin(event) {
                event.preventDefault();
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                // Cari pengguna berdasarkan email dan password
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    
                    if (user.isAdmin) {
                        showAdminPanel();
                    } else {
                        showPage('home');
                        showNotification('Login berhasil! Selamat datang, ' + user.name);
                    }
                } else {
                    showNotification('Email atau password salah!', 'error');
                }
            }

            // Fungsi untuk menangani registrasi
            function handleRegister(event) {
                event.preventDefault();
                
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                // Validasi password
                if (password !== confirmPassword) {
                    showNotification('Password tidak cocok!', 'error');
                    return;
                }
                
                // Cek apakah email sudah terdaftar
                const existingUser = users.find(u => u.email === email);
                
                if (existingUser) {
                    showNotification('Email sudah terdaftar!', 'error');
                    return;
                }
                
                // Buat pengguna baru
                const newUser = {
                    id: users.length + 1,
                    name: name,
                    email: email,
                    password: password,
                    isAdmin: false
                };
                
                users.push(newUser);
                
                showNotification('Registrasi berhasil! Silakan login.');
                showPage('login');
            }

            // Fungsi untuk menampilkan panel admin
            function showAdminPanel() {
                document.getElementById('public-view').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                
                // Tampilkan dashboard admin
                showAdminPage('dashboard');
                
                // Update statistik dashboard
                updateAdminDashboard();
            }

            // Fungsi untuk menampilkan halaman admin
            function showAdminPage(pageId) {
                // Sembunyikan semua halaman admin
                const adminPages = document.querySelectorAll('.admin-page-content');
                adminPages.forEach(page => {
                    page.classList.add('d-none');
                });
                
                // Tampilkan halaman yang dipilih
                const selectedPage = document.getElementById(`admin-${pageId}`);
                if (selectedPage) {
                    selectedPage.classList.remove('d-none');
                }
                
                // Update judul halaman
                document.getElementById('admin-page-title').textContent = pageId.charAt(0).toUpperCase() + pageId.slice(1);
                
                // Update menu aktif
                const menuItems = document.querySelectorAll('.admin-menu a');
                menuItems.forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeMenuItem = document.querySelector(`.admin-menu a[onclick="showAdminPage('${pageId}')"]`);
                if (activeMenuItem) {
                    activeMenuItem.classList.add('active');
                }
                
                // Tampilkan konten halaman yang dipilih
                if (pageId === 'products') {
                    displayAdminProducts();
                } else if (pageId === 'orders') {
                    displayAdminOrders();
                } else if (pageId === 'customers') {
                    displayAdminCustomers();
                } else if (pageId === 'chat') {
                    displayAdminChat();
                }
            }

            // Fungsi untuk memperbarui dashboard admin
            function updateAdminDashboard() {
                document.getElementById('total-orders').textContent = orders.length;
                document.getElementById('completed-orders').textContent = orders.filter(order => order.status === 'completed').length;
                document.getElementById('total-products').textContent = products.length;
                document.getElementById('total-customers').textContent = users.filter(user => !user.isAdmin).length;
            }

            // Fungsi untuk menampilkan produk di panel admin
            function displayAdminProducts() {
                const adminProductsList = document.getElementById('admin-products-list');
                adminProductsList.innerHTML = '';
                
                products.forEach(product => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${product.id}</td>
                        <td><img src="${product.image}" alt="${product.name}" width="50"></td>
                        <td>${product.name}</td>
                        <td>${product.category}</td>
                        <td>Rp ${product.price.toLocaleString('id-ID')}</td>
                        <td>${product.stock}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    adminProductsList.appendChild(tr);
                });
            }

            // Fungsi untuk menampilkan pesanan di panel admin
            function displayAdminOrders() {
                const adminOrdersList = document.getElementById('admin-orders-list');
                adminOrdersList.innerHTML = '';
                
                if (orders.length === 0) {
                    adminOrdersList.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">Tidak ada pesanan</td>
                        </tr>
                    `;
                    return;
                }
                
                orders.forEach(order => {
                    const statusClass = order.status === 'processing' ? 'processing' : 
                                       order.status === 'shipping' ? 'shipping' : 'completed';
                    
                    const statusText = order.status === 'processing' ? 'Sedang Diproses' : 
                                     order.status === 'shipping' ? 'Sedang Dikirim' : 'Selesai';
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>#${order.id}</td>
                        <td>${order.customerName}</td>
                        <td>Rp ${order.total.toLocaleString('id-ID')}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${new Date(order.date).toLocaleDateString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="viewAdminOrder(${order.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="updateOrderStatus(${order.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    
                    adminOrdersList.appendChild(tr);
                });
            }

            // Fungsi untuk melihat detail pesanan di admin
            function viewAdminOrder(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                let itemsHtml = '';
                
                order.items.forEach(item => {
                    itemsHtml += `
                        <div class="order-item">
                            <span>${item.name} x ${item.quantity}</span>
                            <span>Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</span>
                        </div>
                    `;
                });
                
                // Buat modal untuk menampilkan detail pesanan
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'orderDetailModal';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Detail Pesanan #${order.id}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Informasi Pelanggan</h6>
                                        <p><strong>Nama:</strong> ${order.customerName}</p>
                                        <p><strong>Telepon:</strong> ${order.customerPhone}</p>
                                        <p><strong>Alamat:</strong> ${order.customerAddress}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Informasi Pesanan</h6>
                                        <p><strong>Tanggal:</strong> ${new Date(order.date).toLocaleString('id-ID')}</p>
                                        <p><strong>Metode Pembayaran:</strong> ${order.paymentMethod === 'cod' ? 'Cash on Delivery (COD)' : 'Transfer Bank'}</p>
                                        <p><strong>Status:</strong> <span class="status-badge ${order.status === 'processing' ? 'processing' : order.status === 'shipping' ? 'shipping' : 'completed'}">${order.status === 'processing' ? 'Sedang Diproses' : order.status === 'shipping' ? 'Sedang Dikirim' : 'Selesai'}</span></p>
                                    </div>
                                </div>
                                <hr>
                                <h6>Item Pesanan</h6>
                                <div class="order-items">
                                    ${itemsHtml}
                                </div>
                                <hr>
                                <div class="order-total">
                                    <span>Total:</span>
                                    <span>Rp ${order.total.toLocaleString('id-ID')}</span>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                                <button type="button" class="btn btn-primary" onclick="updateOrderStatus(${order.id})">Update Status</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Tampilkan modal
                const orderModal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
                orderModal.show();
                
                // Hapus modal setelah ditutup
                document.getElementById('orderDetailModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }

            // Fungsi untuk memperbarui status pesanan
            function updateOrderStatus(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                // Buat modal untuk update status
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'updateStatusModal';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Update Status Pesanan #${order.id}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="updateStatusForm">
                                    <div class="mb-3">
                                        <label class="form-label">Status</label>
                                        <select class="form-select" id="new-status">
                                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Sedang Diproses</option>
                                            <option value="shipping" ${order.status === 'shipping' ? 'selected' : ''}>Sedang Dikirim</option>
                                            <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Selesai</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Catatan</label>
                                        <textarea class="form-control" id="status-note" rows="3" placeholder="Catatan untuk status ini"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                <button type="button" class="btn btn-primary" onclick="saveOrderStatus(${orderId})">Simpan</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Tampilkan modal
                const statusModal = new bootstrap.Modal(document.getElementById('updateStatusModal'));
                statusModal.show();
                
                // Hapus modal setelah ditutup
                document.getElementById('updateStatusModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }

            // Fungsi untuk menyimpan status pesanan
            function saveOrderStatus(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                const newStatus = document.getElementById('new-status').value;
                const statusNote = document.getElementById('status-note').value;
                
                // Update status pesanan
                order.status = newStatus;
                
                // Tambahkan ke riwayat status
                order.statusHistory.push({
                    status: newStatus,
                    timestamp: new Date().toISOString(),
                    note: statusNote || `Status diubah menjadi ${newStatus === 'processing' ? 'Sedang Diproses' : newStatus === 'shipping' ? 'Sedang Dikirim' : 'Selesai'}`
                });
                
                // Simpan data
                saveOrdersData();
                
                // Tutup modal
                const statusModal = bootstrap.Modal.getInstance(document.getElementById('updateStatusModal'));
                statusModal.hide();
                
                // Perbarui tampilan
                displayAdminOrders();
                
                // Tampilkan notifikasi
                showNotification('Status pesanan berhasil diperbarui!');
            }

            // Fungsi untuk menampilkan pelanggan di panel admin
            function displayAdminCustomers() {
                const adminCustomersList = document.getElementById('admin-customers-list');
                adminCustomersList.innerHTML = '';
                
                // Filter hanya pelanggan (bukan admin)
                const customers = users.filter(user => !user.isAdmin);
                
                if (customers.length === 0) {
                    adminCustomersList.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">Tidak ada pelanggan</td>
                        </tr>
                    `;
                    return;
                }
                
                customers.forEach(customer => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${customer.id}</td>
                        <td>${customer.name}</td>
                        <td>${customer.email}</td>
                        <td>${new Date(customer.createdAt || Date.now()).toLocaleDateString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="viewCustomer(${customer.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${customer.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    adminCustomersList.appendChild(tr);
                });
            }

            // Fungsi untuk melihat detail pelanggan
            function viewCustomer(customerId) {
                const customer = users.find(u => u.id === customerId);
                if (!customer) return;
                
                // Buat modal untuk menampilkan detail pelanggan
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'customerDetailModal';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Detail Pelanggan</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">ID</label>
                                    <input type="text" class="form-control" value="${customer.id}" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nama</label>
                                    <input type="text" class="form-control" value="${customer.name}" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" value="${customer.email}" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Tanggal Daftar</label>
                                    <input type="text" class="form-control" value="${new Date(customer.createdAt || Date.now()).toLocaleString('id-ID')}" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Total Pesanan</label>
                                    <input type="text" class="form-control" value="${orders.filter(order => order.customerEmail === customer.email).length}" readonly>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Tampilkan modal
                const customerModal = new bootstrap.Modal(document.getElementById('customerDetailModal'));
                customerModal.show();
                
                // Hapus modal setelah ditutup
                document.getElementById('customerDetailModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }

            // Fungsi untuk menghapus pelanggan
            function deleteCustomer(customerId) {
                if (confirm('Apakah Anda yakin ingin menghapus pelanggan ini?')) {
                    users = users.filter(user => user.id !== customerId);
                    
                    // Simpan data
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Perbarui tampilan
                    displayAdminCustomers();
                    
                    // Tampilkan notifikasi
                    showNotification('Pelanggan berhasil dihapus!');
                }
            }

            // Fungsi untuk menampilkan chat di panel admin
            function displayAdminChat() {
                const adminChatSidebar = document.getElementById('admin-chat-sidebar');
                adminChatSidebar.innerHTML = '';
                
                if (chatUsers.length === 0) {
                    adminChatSidebar.innerHTML = `
                        <div class="text-center py-3">
                            <p>Tidak ada percakapan</p>
                        </div>
                    `;
                    return;
                }
                
                chatUsers.forEach(user => {
                    const chatUserDiv = document.createElement('div');
                    chatUserDiv.className = 'chat-user';
                    if (currentChatUser && currentChatUser.id === user.id) {
                        chatUserDiv.classList.add('active');
                    }
                    
                    // Cek apakah ada pesan yang belum dibaca
                    const unreadCount = chatMessages[user.id] ? 
                        chatMessages[user.id].filter(msg => msg.sender === 'user' && !msg.read).length : 0;
                    
                    // Dapatkan pesan terakhir
                    let lastMessage = '';
                    if (chatMessages[user.id] && chatMessages[user.id].length > 0) {
                        const messages = chatMessages[user.id];
                        lastMessage = messages[messages.length - 1].text;
                        if (lastMessage.length > 30) {
                            lastMessage = lastMessage.substring(0, 30) + '...';
                        }
                    }
                    
                    chatUserDiv.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div onclick="selectChatUser(${user.id})" style="cursor: pointer; flex: 1;">
                                <div class="chat-user-name">${user.name}</div>
                                <div class="chat-user-preview">${lastMessage || 'Belum ada pesan'}</div>
                            </div>
                            ${unreadCount > 0 ? `<span class="badge bg-danger">${unreadCount}</span>` : ''}
                        </div>
                    `;
                    
                    adminChatSidebar.appendChild(chatUserDiv);
                });
                
                // Update notifikasi chat
                updateChatNotification();
            }

            // Fungsi untuk memilih pengguna chat
            function selectChatUser(userId) {
                currentChatUser = chatUsers.find(user => user.id === userId);
                
                if (currentChatUser) {
                    // Update header chat
                    document.getElementById('admin-chat-user-name').textContent = currentChatUser.name;
                    
                    // Tandai semua pesan sebagai sudah dibaca
                    if (chatMessages[currentChatUser.id]) {
                        chatMessages[currentChatUser.id].forEach(msg => {
                            if (msg.sender === 'user') {
                                msg.read = true;
                            }
                        });
                        
                        // Simpan data
                        saveChatData();
                    }
                    
                    // Tampilkan pesan
                    displayAdminChatMessages();
                    
                    // Update tampilan daftar pengguna
                    displayAdminChat();
                }
            }

            // Fungsi untuk menampilkan pesan chat di admin
            function displayAdminChatMessages() {
                const adminChatMessages = document.getElementById('admin-chat-messages');
                adminChatMessages.innerHTML = '';
                
                if (!currentChatUser || !chatMessages[currentChatUser.id]) {
                    adminChatMessages.innerHTML = `
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-comments" style="font-size: 3rem;"></i>
                            <p class="mt-3">Tidak ada pesan</p>
                        </div>
                    `;
                    return;
                }
                
                const messages = chatMessages[currentChatUser.id];
                
                messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `chat-message ${message.sender === 'admin' ? 'admin' : 'user'}`;
                    
                    const bubbleDiv = document.createElement('div');
                    bubbleDiv.className = 'chat-bubble';
                    bubbleDiv.textContent = message.text;
                    
                    const timeDiv = document.createElement('div');
                    timeDiv.className = 'chat-time';
                    timeDiv.textContent = new Date(message.timestamp).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                    
                    messageDiv.appendChild(bubbleDiv);
                    messageDiv.appendChild(timeDiv);
                    
                    adminChatMessages.appendChild(messageDiv);
                });
                
                // Scroll ke bawah
                adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
            }

            // Fungsi untuk mengirim pesan dari admin
            function sendAdminMessage() {
                const messageInput = document.getElementById('admin-chat-message');
                const messageText = messageInput.value.trim();
                
                if (!messageText || !currentChatUser) return;
                
                // Buat pesan baru
                const message = {
                    text: messageText,
                    sender: 'admin',
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                // Tambahkan ke pesan
                if (!chatMessages[currentChatUser.id]) {
                    chatMessages[currentChatUser.id] = [];
                }
                
                chatMessages[currentChatUser.id].push(message);
                
                // Simpan data
                saveChatData();
                
                // Kosongkan input
                messageInput.value = '';
                
                // Tampilkan pesan
                displayAdminChatMessages();
                
                // Update status typing
                updateTypingStatus(currentChatUser.id, false);
            }

            // Fungsi untuk menangani keypress di input chat admin
            function handleAdminChatKeyPress(event) {
                if (event.key === 'Enter') {
                    sendAdminMessage();
                } else {
                    // Update status typing
                    if (currentChatUser) {
                        updateTypingStatus(currentChatUser.id, true);
                        
                        // Set timeout untuk menghapus status typing setelah 5 detik tidak ada aktivitas
                        clearTimeout(window.typingTimeout);
                        window.typingTimeout = setTimeout(() => {
                            updateTypingStatus(currentChatUser.id, false);
                        }, 5000);
                    }
                }
            }

            // Fungsi untuk menambah produk
            function showAddProductModal() {
                // Buat modal untuk menambah produk
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'addProductModal';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Tambah Produk</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addProductForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Nama Produk</label>
                                                <input type="text" class="form-control" id="product-name" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Kategori</label>
                                                <select class="form-select" id="product-category" required>
                                                    <option value="">Pilih Kategori</option>
                                                    <option value="sayuran">Sayuran</option>
                                                    <option value="bumbu">Bumbu Dapur</option>
                                                    <option value="organik">Produk Organik</option>
                                                    <option value="premium">Premium</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Harga</label>
                                                <input type="number" class="form-control" id="product-price" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Stok</label>
                                                <input type="number" class="form-control" id="product-stock" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">URL Gambar</label>
                                                <input type="text" class="form-control" id="product-image" placeholder="https://example.com/image.jpg">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Deskripsi</label>
                                                <textarea class="form-control" id="product-description" rows="5" required></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                <button type="button" class="btn btn-primary" onclick="addProduct()">Simpan</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Tampilkan modal
                const productModal = new bootstrap.Modal(document.getElementById('addProductModal'));
                productModal.show();
                
                // Hapus modal setelah ditutup
                document.getElementById('addProductModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }

            // Fungsi untuk menambah produk
            function addProduct() {
                const name = document.getElementById('product-name').value.trim();
                const category = document.getElementById('product-category').value;
                const price = parseInt(document.getElementById('product-price').value);
                const stock = parseInt(document.getElementById('product-stock').value);
                const image = document.getElementById('product-image').value.trim() || `https://picsum.photos/seed/${name}/600/400.jpg`;
                const description = document.getElementById('product-description').value.trim();
                
                if (!name || !category || !price || !stock || !description) {
                    showNotification('Harap lengkapi semua field yang diperlukan!', 'error');
                    return;
                }
                
                // Buat produk baru
                const newProduct = {
                    id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                    name: name,
                    category: category,
                    price: price,
                    stock: stock,
                    image: image,
                    description: description
                };
                
                // Tambahkan ke daftar produk
                products.push(newProduct);
                
                // Simpan data
                localStorage.setItem('products', JSON.stringify(products));
                
                // Tutup modal
                const productModal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
                productModal.hide();
                
                // Perbarui tampilan
                displayAdminProducts();
                
                // Tampilkan notifikasi
                showNotification('Produk berhasil ditambahkan!');
            }

            // Fungsi untuk mengedit produk
            function editProduct(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                // Buat modal untuk mengedit produk
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.id = 'editProductModal';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Edit Produk</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editProductForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">ID</label>
                                                <input type="text" class="form-control" value="${product.id}" readonly>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Nama Produk</label>
                                                <input type="text" class="form-control" id="edit-product-name" value="${product.name}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Kategori</label>
                                                <select class="form-select" id="edit-product-category" required>
                                                    <option value="sayuran" ${product.category === 'sayuran' ? 'selected' : ''}>Sayuran</option>
                                                    <option value="bumbu" ${product.category === 'bumbu' ? 'selected' : ''}>Bumbu Dapur</option>
                                                    <option value="organik" ${product.category === 'organik' ? 'selected' : ''}>Produk Organik</option>
                                                    <option value="premium" ${product.category === 'premium' ? 'selected' : ''}>Premium</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Harga</label>
                                                <input type="number" class="form-control" id="edit-product-price" value="${product.price}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Stok</label>
                                                <input type="number" class="form-control" id="edit-product-stock" value="${product.stock}" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">URL Gambar</label>
                                                <input type="text" class="form-control" id="edit-product-image" value="${product.image}">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Deskripsi</label>
                                                <textarea class="form-control" id="edit-product-description" rows="5" required>${product.description}</textarea>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                <button type="button" class="btn btn-primary" onclick="saveProduct(${productId})">Simpan</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Tampilkan modal
                const productModal = new bootstrap.Modal(document.getElementById('editProductModal'));
                productModal.show();
                
                // Hapus modal setelah ditutup
                document.getElementById('editProductModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }

            // Fungsi untuk menyimpan perubahan produk
            function saveProduct(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                const name = document.getElementById('edit-product-name').value.trim();
                const category = document.getElementById('edit-product-category').value;
                const price = parseInt(document.getElementById('edit-product-price').value);
                const stock = parseInt(document.getElementById('edit-product-stock').value);
                const image = document.getElementById('edit-product-image').value.trim();
                const description = document.getElementById('edit-product-description').value.trim();
                
                if (!name || !category || !price || !stock || !description) {
                    showNotification('Harap lengkapi semua field yang diperlukan!', 'error');
                    return;
                }
                
                // Update produk
                product.name = name;
                product.category = category;
                product.price = price;
                product.stock = stock;
                if (image) product.image = image;
                product.description = description;
                
                // Simpan data
                localStorage.setItem('products', JSON.stringify(products));
                
                // Tutup modal
                const productModal = bootstrap.Modal.getInstance(document.getElementById('editProductModal'));
                productModal.hide();
                
                // Perbarui tampilan
                displayAdminProducts();
                
                // Tampilkan notifikasi
                showNotification('Produk berhasil diperbarui!');
            }

            // Fungsi untuk menghapus produk
            function deleteProduct(productId) {
                if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                    products = products.filter(product => product.id !== productId);
                    
                    // Simpan data
                    localStorage.setItem('products', JSON.stringify(products));
                    
                    // Perbarui tampilan
                    displayAdminProducts();
                    
                    // Tampilkan notifikasi
                    showNotification('Produk berhasil dihapus!');
                }
            }

            // Fungsi untuk menampilkan notifikasi
            function showNotification(message, type = 'success') {
                // Buat elemen notifikasi
                const notification = document.createElement('div');
                notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.zIndex = '9999';
                notification.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `;
                
                document.body.appendChild(notification);
                
                // Hapus notifikasi setelah 3 detik
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 150);
                }, 3000);
            }

            // Fungsi untuk toggle chat widget
            function toggleChat() {
                const chatWidget = document.getElementById('chat-widget');
                const chatToggleIcon = document.getElementById('chat-toggle-icon');
                
                chatWidget.classList.toggle('opened');
                
                if (chatWidget.classList.contains('opened')) {
                    chatToggleIcon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                    localStorage.setItem('chatOpened', 'true');
                } else {
                    chatToggleIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                    localStorage.setItem('chatOpened', 'false');
                }
            }

            // Fungsi untuk memulai chat
            function startChat() {
                const name = document.getElementById('chat-name').value.trim();
                const email = document.getElementById('chat-email').value.trim();
                
                if (!name || !email) {
                    showNotification('Harap lengkapi nama dan email!', 'error');
                    return;
                }
                
                // Buat pengguna chat baru
                const newChatUser = {
                    id: Date.now(),
                    name: name,
                    email: email
                };
                
                // Tambahkan ke daftar pengguna chat
                chatUsers.push(newChatUser);
                
                // Simpan data
                saveChatData();
                
                // Set sebagai pengguna chat saat ini
                chatUser = newChatUser;
                
                // Tampilkan input chat
                document.getElementById('chat-form').classList.add('d-none');
                document.getElementById('chat-input').classList.remove('d-none');
                
                // Muat pesan
                loadChatMessages(newChatUser.id);
                
                // Tambahkan pesan sambutan
                const welcomeMessage = {
                    text: `Halo ${name}! Selamat datang di Raja Sayur Store. Ada yang bisa kami bantu?`,
                    sender: 'admin',
                    timestamp: new Date().toISOString(),
                    isAutoResponse: true
                };
                
                if (!chatMessages[newChatUser.id]) {
                    chatMessages[newChatUser.id] = [];
                }
                
                chatMessages[newChatUser.id].push(welcomeMessage);
                
                // Simpan data
                saveChatData();
                
                // Tampilkan pesan
                loadChatMessages(newChatUser.id);
                
                // Update notifikasi chat
                updateChatNotification();
            }

            // Fungsi untuk memuat pesan chat
            function loadChatMessages(userId) {
                const chatBody = document.getElementById('chat-body');
                chatBody.innerHTML = '';
                
                if (!chatMessages[userId]) {
                    chatMessages[userId] = [];
                }
                
                const messages = chatMessages[userId];
                
                messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `chat-message ${message.sender === 'admin' ? 'admin' : 'user'}`;
                    
                    const bubbleDiv = document.createElement('div');
                    bubbleDiv.className = 'chat-bubble';
                    bubbleDiv.textContent = message.text;
                    
                    const timeDiv = document.createElement('div');
                    timeDiv.className = 'chat-time';
                    timeDiv.textContent = new Date(message.timestamp).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                    
                    messageDiv.appendChild(bubbleDiv);
                    messageDiv.appendChild(timeDiv);
                    
                    chatBody.appendChild(messageDiv);
                });
                
                // Scroll ke bawah
                chatBody.scrollTop = chatBody.scrollHeight;
            }

            // Fungsi untuk mengirim pesan
            function sendMessage() {
                const messageInput = document.getElementById('chat-message');
                const messageText = messageInput.value.trim();
                
                if (!messageText || !chatUser) return;
                
                // Buat pesan baru
                const message = {
                    text: messageText,
                    sender: 'user',
                    timestamp: new Date().toISOString(),
                    isAutoResponse: false
                };
                
                // Tambahkan ke pesan
                if (!chatMessages[chatUser.id]) {
                    chatMessages[chatUser.id] = [];
                }
                
                chatMessages[chatUser.id].push(message);
                
                // Simpan data
                saveChatData();
                
                // Kosongkan input
                messageInput.value = '';
                
                // Tampilkan pesan
                loadChatMessages(chatUser.id);
                
                // Update status typing
                updateTypingStatus(chatUser.id, false);
                
                // Cek apakah admin online
                if (adminOnline) {
                    // Tampilkan indikator admin sedang mengetik
                    showTypingIndicator(chatUser.id, true);
                    
                    // Simulasikan admin sedang mengetik
                    setTimeout(() => {
                        showTypingIndicator(chatUser.id, false);
                        
                        // Kirim auto-response
                        sendAutoResponse(chatUser.id);
                    }, 2000);
                } else {
                    // Kirim auto-response bahwa admin sedang offline
                    const offlineMessage = {
                        text: "Terima kasih telah menghubungi kami. Saat ini admin sedang offline. Kami akan merespons pesan Anda secepatnya.",
                        sender: 'admin',
                        timestamp: new Date().toISOString(),
                        isAutoResponse: true
                    };
                    
                    chatMessages[chatUser.id].push(offlineMessage);
                    saveChatData();
                    loadChatMessages(chatUser.id);
                }
                
                // Update notifikasi chat
                updateChatNotification();
            }

            // Fungsi untuk menangani keypress di input chat
            function handleChatKeyPress(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                } else {
                    // Update status typing
                    if (chatUser) {
                        updateTypingStatus(chatUser.id, true);
                        
                        // Set timeout untuk menghapus status typing setelah 5 detik tidak ada aktivitas
                        clearTimeout(window.typingTimeout);
                        window.typingTimeout = setTimeout(() => {
                            updateTypingStatus(chatUser.id, false);
                        }, 5000);
                    }
                }
            }

            // Fungsi untuk memeriksa pesan baru
            function checkNewMessages() {
                if (chatUser && chatMessages[chatUser.id]) {
                    const messages = chatMessages[chatUser.id];
                    const lastMessage = messages[messages.length - 1];
                    
                    // Jika ada pesan baru dari admin dan bukan auto-response
                    if (lastMessage && lastMessage.sender === 'admin' && !lastMessage.isAutoResponse && !lastMessage.read) {
                        // Tandai sebagai sudah dibaca
                        lastMessage.read = true;
                        
                        // Simpan data
                        saveChatData();
                        
                        // Tampilkan pesan
                        loadChatMessages(chatUser.id);
                    }
                }
            }

            // Fungsi untuk memperbarui notifikasi chat
            function updateChatNotification() {
                let unreadCount = 0;
                
                // Hitung jumlah pesan yang belum dibaca
                Object.keys(chatMessages).forEach(userId => {
                    if (chatMessages[userId]) {
                        unreadCount += chatMessages[userId].filter(msg => msg.sender === 'user' && !msg.read).length;
                    }
                });
                
                // Update notifikasi di menu admin
                const adminChatNotification = document.getElementById('admin-chat-notification');
                if (adminChatNotification) {
                    if (unreadCount > 0) {
                        adminChatNotification.textContent = unreadCount;
                        adminChatNotification.style.display = 'inline-block';
                    } else {
                        adminChatNotification.style.display = 'none';
                    }
                }
                
                // Update notifikasi di chat widget
                const chatNotification = document.querySelector('.chat-notification');
                if (chatNotification) {
                    if (unreadCount > 0) {
                        chatNotification.textContent = unreadCount;
                        chatNotification.style.display = 'flex';
                    } else {
                        chatNotification.style.display = 'none';
                    }
                }
            }

            // Fungsi untuk menangani login admin
            function handleAdminLogin(event) {
                event.preventDefault();
                
                const email = document.getElementById('admin-email').value;
                const password = document.getElementById('admin-password').value;
                
                // Cari admin berdasarkan email dan password
                const admin = users.find(u => u.email === email && u.password === password && u.isAdmin);
                
                if (admin) {
                    currentUser = admin;
                    localStorage.setItem('currentUser', JSON.stringify(admin));
                    
                    // Tutup modal
                    const adminLoginModal = bootstrap.Modal.getInstance(document.getElementById('adminLoginModal'));
                    adminLoginModal.hide();
                    
                    // Tampilkan panel admin
                    showAdminPanel();
                    
                    // Update status admin
                    updateAdminStatus();
                } else {
                    showNotification('Email atau password admin salah!', 'error');
                }
            }

            // Fungsi untuk logout admin
            function logoutAdmin() {
                if (confirm('Apakah Anda yakin ingin logout?')) {
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    
                    // Update status admin
                    adminOnline = false;
                    if (window.firebaseAvailable && window.db) {
                        window.db.collection('adminStatus').doc('status').set({
                            online: false,
                            lastActivity: new Date().getTime()
                        }).catch(error => {
                            console.error('Error updating admin status on logout:', error);
                        });
                    }
                    
                    // Tampilkan halaman publik
                    document.getElementById('admin-panel').style.display = 'none';
                    document.getElementById('public-view').style.display = 'block';
                    
                    // Tampilkan halaman beranda
                    showPage('home');
                    
                    // Tampilkan notifikasi
                    showNotification('Anda telah berhasil logout!');
                }
            }

            // Inisialisasi aplikasi
            function initApp() {
                // Tampilkan produk unggulan di halaman beranda
                displayFeaturedProducts();
                
                // Perbarui jumlah keranjang
                updateCartCount();
                
                // Cek apakah ada pengguna yang tersimpan di localStorage
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                }
                
                // Load data pesanan
                loadOrdersData();
                
                // Load data chat
                loadChatData();
                
                // Cek koneksi Firebase
                checkFirebaseConnection();
                
                // Tampilkan indikator koneksi
                showConnectionIndicator();
                
                // Setup listeners untuk real-time updates jika Firebase tersedia
                if (window.firebaseAvailable) {
                    setupRealtimeListeners();
                    
                    // Cek status admin setiap 30 detik
                    setInterval(checkAdminStatus, 30000);
                    
                    // Update status admin saat admin aktif
                    if (document.getElementById('admin-panel').style.display !== 'none') {
                        updateAdminStatus();
                        
                        // Update status setiap ada aktivitas admin
                        document.addEventListener('click', function() {
                            if (document.getElementById('admin-panel').style.display !== 'none') {
                                updateAdminStatus();
                            }
                        });
                        
                        document.addEventListener('keypress', function() {
                            if (document.getElementById('admin-panel').style.display !== 'none') {
                                updateAdminStatus();
                            }
                        });
                    }
                }
                
                // Cek apakah widget chat sudah dibuka sebelumnya
                const chatOpened = localStorage.getItem('chatOpened');
                if (chatOpened === 'true') {
                    document.getElementById('chat-widget').classList.add('opened');
                    document.getElementById('chat-toggle-icon').classList.replace('fa-chevron-down', 'fa-chevron-up');
                }
                
                // Update chat notification
                updateChatNotification();
                
                // Request notification permission
                if ("Notification" in window && Notification.permission === "default") {
                    Notification.requestPermission();
                }
            }

            // Jalankan inisialisasi aplikasi
            initApp();
        }
    </script>
</body>
</html>
